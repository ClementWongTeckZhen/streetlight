<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Street Light Monitor</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f5f5f5; }
    h2 { margin-top: 20px; }
    .value-box { 
      display: inline-block; 
      margin: 10px; 
      padding: 15px 25px; 
      border-radius: 12px; 
      background: white; 
      box-shadow: 0 2px 6px rgba(0,0,0,0.2); 
      font-size: 20px;
    }
    canvas { max-width: 600px; margin: 20px auto; }
  </style>
</head>
<body>

  <h2>üåô Smart Street Light Monitor</h2>

  <div id="ldrBox" class="value-box">LDR: --</div>
  <div id="brightnessBox" class="value-box">Brightness: --</div>

  <canvas id="chart"></canvas>

  <script>
    const TOKEN = "‰Ω†ÁöÑ_Ubidots_TOKEN";  // ‚Üê ÊîπÊàê‰Ω†ÁöÑ Ubidots TOKEN
    const DEVICE_LABEL = "smart-street-light"; 

    const headers = { "X-Auth-Token": TOKEN, "Content-Type": "application/json" };

    // ÂõæË°®ÂàùÂßãÂåñ
    const ctx = document.getElementById('chart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          { label: 'LDR Value', borderColor: 'blue', data: [], fill: false },
          { label: 'Brightness', borderColor: 'orange', data: [], fill: false }
        ]
      },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    async function fetchData(variable) {
      const url = `https://industrial.api.ubidots.com/api/v1.6/devices/${DEVICE_LABEL}/${variable}/lv`;
      const res = await fetch(url, { headers });
      return res.text(); // ÊúÄÊñ∞ÂÄº
    }

    async function updateData() {
      try {
        const ldr = await fetchData("ldr_value");
        const brightness = await fetchData("brightness");

        document.getElementById("ldrBox").innerText = "LDR: " + ldr;
        document.getElementById("brightnessBox").innerText = "Brightness: " + brightness;

        const time = new Date().toLocaleTimeString();
        chart.data.labels.push(time);
        chart.data.datasets[0].data.push(Number(ldr));
        chart.data.datasets[1].data.push(Number(brightness));

        if (chart.data.labels.length > 20) { // Âè™‰øùÁïô20‰∏™ÁÇπ
          chart.data.labels.shift();
          chart.data.datasets.forEach(d => d.data.shift());
        }

        chart.update();
      } catch (e) {
        console.error("Fetch error:", e);
      }
    }

    // ÊØè5ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°
    setInterval(updateData, 5000);
    updateData();
  </script>

</body>
</html>
